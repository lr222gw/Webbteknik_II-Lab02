"use strict";var MessageBoard={messages:[],textField:null,messageArea:null,nameField:null,lastCount:0,numOfMessages:0,init:function(e){MessageBoard.textField=document.getElementById("inputText");MessageBoard.nameField=document.getElementById("inputName");MessageBoard.messageArea=document.getElementById("messagearea");document.getElementById("inputText").onfocus=function(e){this.className="focus"};document.getElementById("inputText").onblur=function(e){this.className="blur"};document.getElementById("buttonSend").onclick=function(e){MessageBoard.sendMessage();return false};MessageBoard.textField.onkeypress=function(e){if(!e){var e=window.event}if(e.keyCode==13&&!e.shiftKey){MessageBoard.sendMessage();return false}};MessageBoard.getMessages()},getMessages:function(){$.ajax({type:"GET",url:"ajaxpoll.php",async:true,data:{"function":"getMessages",numOfMessages:MessageBoard.numOfMessages},success:function(data){var counter=0;console.log("Ajaxar");data=JSON.parse(data);data.reverse();for(var count in data){counter++}if(counter>MessageBoard.lastCount){MessageBoard.lastCount=counter;window.scrollTo(0,0);document.getElementById("messagearea").innerHTML="";for(var mess in data){var obj=data[mess];var text=obj.name+" said:\n"+obj.message;var mess=new Message(text,new Date(data[mess].date));var messageID=MessageBoard.messages.push(mess)-1;MessageBoard.renderMessage(messageID)}document.getElementById("nrOfMessages").innerHTML=MessageBoard.messages.length}MessageBoard.numOfMessages=data.length;setTimeout(MessageBoard.getMessages,6e3)},error:function(){setTimeout(MessageBoard.getMessages,6e3)}})},sendMessage:function(){if(MessageBoard.textField.value=="")return;$.ajax({type:"GET",url:"functions.php",data:{"function":"add",name:MessageBoard.nameField.value,message:MessageBoard.textField.value},success:function(data){console.log("Your message is (maybe) saved! Can't be sure since i don't check...")}});window.location.reload()},renderMessages:function(){MessageBoard.messageArea.innerHTML="";for(var i=0;i<MessageBoard.messages.length;++i){MessageBoard.renderMessage(i)}document.getElementById("nrOfMessages").innerHTML=MessageBoard.messages.length},renderMessage:function(messageID){var div=document.createElement("div");div.className="message";var aTag=document.createElement("a");aTag.href="#";aTag.onclick=function(){MessageBoard.showTime(messageID);return false};var imgClock=document.createElement("img");imgClock.src="pic/clock.png";imgClock.alt="Show creation time";aTag.appendChild(imgClock);div.appendChild(aTag);var text=document.createElement("p");text.innerHTML=MessageBoard.messages[messageID].getHTMLText();div.appendChild(text);var spanDate=document.createElement("span");spanDate.appendChild(document.createTextNode(MessageBoard.messages[messageID].getDateText()));div.appendChild(spanDate);var spanClear=document.createElement("span");spanClear.className="clear";div.appendChild(spanClear);document.getElementById("messagearea").appendChild(div)},removeMessage:function(messageID){if(window.confirm("Vill du verkligen radera meddelandet?")){MessageBoard.messages.splice(messageID,1);MessageBoard.renderMessages()}},showTime:function(messageID){var time=MessageBoard.messages[messageID].getDate();var showTime="Created "+time.toLocaleDateString()+" at "+time.toLocaleTimeString();alert(showTime)},logout:function(){}};window.onload=MessageBoard.init;